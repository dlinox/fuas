import{n as B,p as D,d as N,e as c,r as a,o as _,c as g,w as t,a as e,u as w,m as W,x as X,g as b,f as K,h as G,i as I,t as Y,q as L,v as M,F as J}from"./index-CyOqr6BN.js";import{i as Z,_ as h}from"./DialogConfirm.vue_vue_type_script_setup_true_lang-Cew_3QDl.js";import{r as z}from"./ruleUtils-DaB-ACZt.js";import{c as ee}from"./worker.services-j163xFSh.js";const R="http://api1.linox.net.pe/api/users",te=async d=>{try{const l=B();return(await D(l,R).post("/load-data-table",d)).data.data}catch{return Z()}},oe=async d=>{try{const l=B();return await D(l,R).post("/save",d),!0}catch{return!1}},se=async d=>{try{const l=B();return await D(l,R).delete(`/delete/${d}`),!0}catch{return!1}},ae=async()=>{try{const d=B(),l=await D(d,R).get("/all-permissions");return console.log(l.data),l.data.data}catch{return[]}},le=async d=>{try{const l=B();return await D(l,R).post("/assign-permissions/",d),!0}catch{return!1}},F={email:[z],password:[],workerId:[z],status:[z]},ne=()=>({id:null,email:"",password:null,workerId:null,permissions:[],status:!0}),Q=N({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(d,{emit:l}){const m=l,i=d,o=c(null),p=c(!1),u=c(!1),n=c({...ne(),...i.formState}),f=c([]),y=async()=>{const{valid:r}=await o.value.validate();if(console.log(n.value),!r)return;await oe(n.value)&&(n.value.id==null&&o.value.reset(),m("onSuccess"),u.value=!1),p.value=!1};return(async()=>{f.value=await ee()})(),(r,s)=>{const C=a("v-list-item"),P=a("v-select"),k=a("v-col"),x=a("v-text-field"),S=a("v-switch"),T=a("v-row"),O=a("v-card-item"),E=a("v-btn"),j=a("v-spacer"),A=a("v-card-actions"),q=a("v-card"),V=a("v-form"),$=a("v-dialog");return _(),g($,{"max-width":"700",modelValue:u.value,"onUpdate:modelValue":s[5]||(s[5]=v=>u.value=v),activator:"parent"},{default:t(()=>[e(V,{ref_key:"formRef",ref:o,onSubmit:K(y,["prevent"])},{default:t(()=>[e(q,{title:n.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(O,{class:"border-t border-b"},{default:t(()=>[e(T,null,{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[e(P,{modelValue:n.value.workerId,"onUpdate:modelValue":s[0]||(s[0]=v=>n.value.workerId=v),label:"Trabajador",items:f.value,rules:w(F).workerId},{item:t(({props:v,item:H})=>[e(C,W(v,{title:H.title,disabled:H.raw.hasUser=="1"}),null,16,["title","disabled"])]),_:1},8,["modelValue","items","rules"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(x,{modelValue:n.value.email,"onUpdate:modelValue":s[1]||(s[1]=v=>n.value.email=v),label:"Correo electrónico",rules:w(F).email,autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),n.value.id?X("",!0):(_(),g(k,{key:0,cols:"12"},{default:t(()=>[e(x,{modelValue:n.value.password,"onUpdate:modelValue":s[2]||(s[2]=v=>n.value.password=v),label:"Contraseña",rules:w(F).password,type:"password",autocomplete:"new-password"},null,8,["modelValue","rules"])]),_:1})),e(k,{cols:"12"},{default:t(()=>[e(S,{label:n.value.status?"Habilitado":"Deshabilitado",modelValue:n.value.status,"onUpdate:modelValue":s[3]||(s[3]=v=>n.value.status=v),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(E,{type:"button",variant:"text",color:"secondary",onClick:s[4]||(s[4]=v=>u.value=!1)},{default:t(()=>s[6]||(s[6]=[b(" Cancelar ")])),_:1}),e(j),e(E,{text:"Guardar",color:"primary",type:"submit",loading:p.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),re=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre Completo",key:"fullName",value:"fullName"},{title:"Correo",key:"email",value:"email"},{title:"Estado",key:"status",value:"status"}],ie=N({__name:"DataTable",props:{options:{},items:{},loading:{type:Boolean},total:{}},emits:["onUpdateTable"],setup(d,{emit:l}){const m=l;return(i,o)=>{const p=a("v-icon"),u=a("v-list-item"),n=a("v-list"),f=a("v-menu"),y=a("v-btn"),U=a("v-data-table-server"),r=G("permission");return _(),g(U,{"items-per-page":i.options.itemsPerPage,"onUpdate:itemsPerPage":[o[1]||(o[1]=s=>i.options.itemsPerPage=s),o[4]||(o[4]=s=>m("onUpdateTable"))],"sort-by":i.options.sortBy,"onUpdate:sortBy":[o[2]||(o[2]=s=>i.options.sortBy=s),o[5]||(o[5]=s=>m("onUpdateTable"))],page:i.options.page,"onUpdate:page":[o[3]||(o[3]=s=>i.options.page=s),o[6]||(o[6]=s=>m("onUpdateTable"))],headers:w(re),items:i.items,"items-length":i.total,loading:i.loading,"item-value":"id","multi-sort":""},{"item.actions":t(({item:s})=>[e(y,{icon:"",density:"compact",variant:"text"},{default:t(()=>[e(p,null,{default:t(()=>o[7]||(o[7]=[b("mdi-dots-vertical")])),_:1}),e(f,{activator:"parent"},{default:t(()=>[e(n,{density:"compact"},{default:t(()=>[I((_(),g(u,{key:"permissions",value:"permissions",class:"text-subtitle-2"},{append:t(()=>[e(p,{size:"small"},{default:t(()=>o[8]||(o[8]=[b(" mdi-lock ")])),_:1})]),default:t(()=>[o[9]||(o[9]=b(" Asignar permisos ")),e(w(ue),{permissions:s.permissions,userId:s.id},null,8,["permissions","userId"])]),_:2},1024)),[[r,["users.assign-permissions"]]]),I((_(),g(u,{key:"edit",value:"edit",class:"text-subtitle-2"},{append:t(()=>[e(p,{size:"small"},{default:t(()=>o[10]||(o[10]=[b(" mdi-pencil ")])),_:1})]),default:t(()=>[o[11]||(o[11]=b(" Editar ")),e(w(Q),{formState:s,onOnSuccess:o[0]||(o[0]=C=>m("onUpdateTable"))},null,8,["formState"])]),_:2},1024)),[[r,["users.edit"]]]),I((_(),g(u,{key:"delete",value:"delete",class:"text-red text-subtitle-2"},{append:t(()=>[e(p,{size:"small",color:"red"},{default:t(()=>o[12]||(o[12]=[b(" mdi-delete ")])),_:1})]),default:t(()=>[e(h,{title:"Eliminar",message:"¿Está seguro de eliminar este registro?",onOnConfirm:async()=>{await w(se)(s.id)&&m("onUpdateTable")}},null,8,["onOnConfirm"]),o[13]||(o[13]=b(" Eliminar "))]),_:2},1024)),[[r,["users.delete"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":t(({item:s})=>[e(y,{color:s.status?"blue":"error","text-color":"white",density:"compact",variant:"tonal"},{default:t(()=>[b(Y(s.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["items-per-page","sort-by","page","headers","items","items-length","loading"])}}}),ue=N({__name:"AssignPermissions",props:{userId:{},permissions:{}},emits:["onSuccess"],setup(d,{emit:l}){const m=d,i=c({userId:m.userId,permissions:[]}),o=c(null),p=c(!1),u=c([...m.permissions]),n=async()=>{i.value.permissions=u.value;let U=await le(i.value);console.log(U)},f=c([]);return(async()=>{f.value=await ae()})(),(U,r)=>{const s=a("v-checkbox"),C=a("v-col"),P=a("v-row"),k=a("v-expansion-panel-text"),x=a("v-expansion-panel"),S=a("v-expansion-panels"),T=a("v-btn"),O=a("v-spacer"),E=a("v-card-actions"),j=a("v-card"),A=a("v-form"),q=a("v-dialog");return _(),g(q,{"max-width":"1000",modelValue:p.value,"onUpdate:modelValue":r[2]||(r[2]=V=>p.value=V),activator:"parent"},{default:t(()=>[e(A,{ref_key:"formRef",ref:o,onSubmit:K(n,["prevent"])},{default:t(()=>[e(j,{title:"Asignar permisos"},{default:t(()=>[e(S,null,{default:t(()=>[(_(!0),L(J,null,M(f.value,V=>(_(),g(x,{key:V.id,title:V.description},{default:t(()=>[e(k,null,{default:t(()=>[e(P,null,{default:t(()=>[(_(!0),L(J,null,M(V.children,$=>(_(),g(C,{cols:"12",sm:"6",md:"4",class:"ma-0 pa-1",key:$.id},{default:t(()=>[e(s,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=v=>u.value=v),label:$.description,value:$.id},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}),e(E,null,{default:t(()=>[e(T,{type:"button",variant:"text",color:"secondary",onClick:r[1]||(r[1]=V=>p.value=!1)},{default:t(()=>r[3]||(r[3]=[b(" Cancelar ")])),_:1}),e(O),e(T,{text:"Guardar",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),ve=N({__name:"index",setup(d){const l=c(!1),m=c(!1),i=c([]),o=c(0),p=c({itemsPerPage:10,sortBy:[],page:1,search:"",filters:{}}),u=async()=>{m.value=!0;const f=await te(p.value);i.value=f.data,o.value=f.total,m.value=!1},n=async()=>{l.value=!0,await u(),l.value=!1};return n(),(f,y)=>{const U=a("v-text-field"),r=a("v-col"),s=a("v-btn"),C=a("v-row"),P=a("v-card-item"),k=a("v-card"),x=G("permission"),S=G("tooltip");return _(),g(k,{title:"Usuarios",subtitle:"Gestión de usuarios",disabled:l.value},{default:t(()=>[e(P,{class:"border-t border-b"},{default:t(()=>[e(C,{class:"d-flex justify-space-between"},{default:t(()=>[e(r,{cols:"12",md:"4"},{default:t(()=>[e(U,{modelValue:p.value.search,"onUpdate:modelValue":y[0]||(y[0]=T=>p.value.search=T),label:"Buscar",clearable:"",onInput:u},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:t(()=>[I((_(),g(s,{class:"h-md-auto me-2",disabled:l.value},{default:t(()=>[y[1]||(y[1]=b(" nuevo ")),e(w(Q),{onOnSuccess:u})]),_:1},8,["disabled"])),[[x,["users.create"]]]),I(e(s,{class:"h-md-auto",density:"comfortable",icon:"mdi-reload",onClick:n,loading:m.value},null,8,["loading"]),[[S,"Recargar registros"],[x,["users.index"]]])]),_:1})]),_:1})]),_:1}),I(e(w(ie),{options:p.value,loading:m.value,items:i.value,total:o.value,onOnUpdateTable:u},null,8,["options","loading","items","total"]),[[x,["users.index"]]])]),_:1},8,["disabled"])}}});export{ve as default};
