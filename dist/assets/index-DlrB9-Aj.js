import{i as E,d as N,e as c,r as o,o as U,c as C,w as t,a as e,u as T,g as u,f as z,j as q,k as G,F as M,t as O,l as F,b as J,n as H}from"./index-5KJAA8ng.js";import{i as K,_ as Q}from"./DialogConfirm.vue_vue_type_script_setup_true_lang-BNt6PR-E.js";import{r as B}from"./ruleUtils-DaB-ACZt.js";import{d as W}from"./debounce-DqPPCsFD.js";const P="https://api.fuas.linox.net.pe/api/categories",X=async _=>{try{const i=localStorage.getItem("token");return(await E(i,P).post("/load-data-table",_)).data.data}catch{return K()}},Y=async _=>{try{const i=localStorage.getItem("token");return await E(i,P).post("/save",_),!0}catch{return!1}},Z=async _=>{try{const i=localStorage.getItem("token");return await E(i,P).delete(`/delete/${_}`),!0}catch{return!1}},j={name:[B],type:[B]},h=()=>({id:null,name:"",type:null,status:!0,services:[]}),L=N({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(_,{emit:i}){const d=i,m=_,v=c(!1),r=c(!1),a=c(null),l=c({...h(),...m.formState}),f=async()=>{const{valid:p}=await a.value.validate();if(!p)return;v.value=!0,await Y(l.value)&&(l.value.id==null&&a.value.reset(),d("onSuccess"),r.value=!1),v.value=!1};return(p,n)=>{const x=o("v-text-field"),b=o("v-col"),y=o("v-select"),w=o("v-switch"),s=o("v-row"),V=o("v-card-item"),S=o("v-btn"),$=o("v-spacer"),R=o("v-card-actions"),g=o("v-card"),D=o("v-form"),k=o("v-dialog");return U(),C(k,{"max-width":"700",modelValue:r.value,"onUpdate:modelValue":n[4]||(n[4]=I=>r.value=I),activator:"parent"},{default:t(()=>[e(D,{ref_key:"formRef",ref:a,onSubmit:z(f,["prevent"])},{default:t(()=>[e(g,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(V,{class:"border-t border-b"},{default:t(()=>[e(s,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=I=>l.value.name=I),label:"Nombre",rules:T(j).name},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(y,{modelValue:l.value.type,"onUpdate:modelValue":n[1]||(n[1]=I=>l.value.type=I),items:["ASISTENCIAL","ADMINISTRATIVO"],label:"Tipo",rules:T(j).type},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(w,{label:l.value.status?"Habilitado":"Deshabilitado",modelValue:l.value.status,"onUpdate:modelValue":n[2]||(n[2]=I=>l.value.status=I),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(R,null,{default:t(()=>[e(S,{type:"button",variant:"text",color:"secondary",onClick:n[3]||(n[3]=I=>r.value=!1)},{default:t(()=>n[5]||(n[5]=[u(" Cancelar ")])),_:1}),e($),e(S,{text:"Guardar",color:"primary",type:"submit",loading:v.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ee=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"name",value:"name"},{title:"Tipo",key:"type",value:"type"},{title:"Estado",key:"status",value:"status"}],te={name:[B]},oe=()=>({id:null,name:"",categoryId:null,status:!0}),ae="https://api.fuas.linox.net.pe/api/services",le=async _=>{try{const i=localStorage.getItem("token");return await E(i,ae).post("/save",_),!0}catch{return!1}},A=N({__name:"ServiceForm",props:{formState:{type:Object,default:()=>({})},categoryId:{type:Number,required:!0}},emits:["onSuccess"],setup(_,{emit:i}){const d=i,m=_,v=c(!1),r=c(!1),a=c(null),l=c({...oe(),...m.formState,categoryId:m.categoryId}),f=async()=>{const{valid:p}=await a.value.validate();if(!p)return;v.value=!0,await le(l.value)&&(l.value.id==null&&a.value.reset(),d("onSuccess"),r.value=!1),v.value=!1};return(p,n)=>{const x=o("v-text-field"),b=o("v-col"),y=o("v-switch"),w=o("v-row"),s=o("v-card-item"),V=o("v-btn"),S=o("v-spacer"),$=o("v-card-actions"),R=o("v-card"),g=o("v-form"),D=o("v-dialog");return U(),C(D,{"max-width":"700",modelValue:r.value,"onUpdate:modelValue":n[3]||(n[3]=k=>r.value=k),activator:"parent"},{default:t(()=>[e(g,{ref_key:"formRef",ref:a,onSubmit:z(f,["prevent"])},{default:t(()=>[e(R,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(s,{class:"border-t border-b"},{default:t(()=>[e(w,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(x,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=k=>l.value.name=k),label:"Nombre",rules:T(te).name},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(y,{label:l.value.status?"Habilitado":"Deshabilitado",modelValue:l.value.status,"onUpdate:modelValue":n[1]||(n[1]=k=>l.value.status=k),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e($,null,{default:t(()=>[e(V,{type:"button",variant:"text",color:"secondary",onClick:n[2]||(n[2]=k=>r.value=!1)},{default:t(()=>n[4]||(n[4]=[u(" Cancelar ")])),_:1}),e(S),e(V,{text:"Guardar",color:"primary",type:"submit",loading:v.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ne=N({__name:"service",props:{category:{}},emits:["onUpdate"],setup(_,{emit:i}){const d=i,m=c(!1),v=c(!1);return(()=>{console.log("init")})(),(a,l)=>{const f=o("v-col"),p=o("v-btn"),n=o("v-row"),x=o("v-card-item"),b=o("v-list-item-title"),y=o("v-icon"),w=o("v-list-item"),s=o("v-list"),V=o("v-menu"),S=o("v-chip"),$=o("v-card"),R=o("v-dialog");return U(),C(R,{"max-width":"600",modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=g=>m.value=g),activator:"parent","max-height":"600"},{default:t(()=>[e($,{title:"Servicios",subtitle:a.category.type+" - "+a.category.name,disabled:v.value},{default:t(()=>[e(x,{class:"border-t border-b"},{default:t(()=>[e(n,{class:"d-flex justify-space-between"},{default:t(()=>[e(f,{cols:"12",md:"7"}),e(f,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:t(()=>[e(p,{class:"me-2",disabled:v.value},{default:t(()=>[l[3]||(l[3]=u(" nuevo ")),e(A,{onOnSuccess:l[0]||(l[0]=g=>d("onUpdate")),categoryId:a.category.id},null,8,["categoryId"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),e(s,null,{default:t(()=>[(U(!0),q(M,null,G(a.category.services,g=>(U(),C(w,{key:g.id},{prepend:t(()=>[e(p,{icon:"",size:"small",variant:"text"},{default:t(()=>[e(y,{size:"small",color:"grey"},{default:t(()=>l[4]||(l[4]=[u(" mdi-dots-vertical ")])),_:1}),e(V,{activator:"parent"},{default:t(()=>[e(s,{density:"compact"},{default:t(()=>[e(w,{key:"edit",value:"edit","append-icon":"mdi-pencil",class:"text-subtitle-2"},{append:t(()=>[e(y,{size:"small"},{default:t(()=>l[5]||(l[5]=[u(" mdi-pencil ")])),_:1})]),default:t(()=>[l[6]||(l[6]=u(" Editar ")),e(A,{onOnSuccess:l[1]||(l[1]=D=>d("onUpdate")),categoryId:a.category.id,formState:g},null,8,["categoryId","formState"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),append:t(()=>[e(S,{color:g.status?"success":"error","text-color":"white"},{default:t(()=>[u(O(g.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),default:t(()=>[e(b,null,{default:t(()=>[u(O(g.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["subtitle","disabled"])]),_:1},8,["modelValue"])}}}),se={class:"d-flex align-center"},re=N({__name:"DataTable",props:{options:{},items:{},loading:{type:Boolean},total:{}},emits:["onUpdateTable"],setup(_,{emit:i}){const d=i,m=c(!1),v=async r=>{m.value=!0,await Z(r)&&d("onUpdateTable"),m.value=!1};return(r,a)=>{const l=o("v-icon"),f=o("v-btn"),p=o("v-list-item"),n=o("v-list"),x=o("v-menu"),b=o("v-chip"),y=o("v-data-table-server"),w=F("tooltip");return U(),C(y,{"items-per-page":r.options.itemsPerPage,"onUpdate:itemsPerPage":[a[2]||(a[2]=s=>r.options.itemsPerPage=s),a[5]||(a[5]=s=>d("onUpdateTable"))],"sort-by":r.options.sortBy,"onUpdate:sortBy":[a[3]||(a[3]=s=>r.options.sortBy=s),a[6]||(a[6]=s=>d("onUpdateTable"))],page:r.options.page,"onUpdate:page":[a[4]||(a[4]=s=>r.options.page=s),a[7]||(a[7]=s=>d("onUpdateTable"))],headers:T(ee),items:r.items,"items-length":r.total,loading:m.value,"item-value":"id","multi-sort":""},{"item.actions":t(({item:s})=>[J("div",se,[H((U(),C(f,{icon:"",density:"compact",color:"black",variant:"text"},{default:t(()=>[e(l,null,{default:t(()=>a[8]||(a[8]=[u("mdi-format-list-bulleted-type")])),_:1}),e(ne,{category:s,onOnUpdate:a[0]||(a[0]=V=>d("onUpdateTable"))},null,8,["category"])]),_:2},1024)),[[w,"Servicios de "+s.name]]),e(f,{icon:"",density:"compact",variant:"text"},{default:t(()=>[e(l,null,{default:t(()=>a[9]||(a[9]=[u("mdi-dots-vertical")])),_:1}),e(x,{activator:"parent"},{default:t(()=>[e(n,{density:"compact"},{default:t(()=>[e(p,{key:"edit",value:"edit","append-icon":"mdi-pencil",class:"text-subtitle-2"},{append:t(()=>[e(l,{size:"small"},{default:t(()=>a[10]||(a[10]=[u(" mdi-pencil ")])),_:1})]),default:t(()=>[a[11]||(a[11]=u(" Editar ")),e(T(L),{formState:s,onOnSuccess:a[1]||(a[1]=V=>d("onUpdateTable"))},null,8,["formState"])]),_:2},1024),e(p,{key:"delete",value:"delete",class:"text-red text-subtitle-2"},{append:t(()=>[e(l,{size:"small",color:"red"},{default:t(()=>a[12]||(a[12]=[u(" mdi-delete ")])),_:1})]),default:t(()=>[a[13]||(a[13]=u(" Eliminar ")),e(Q,{title:"Eliminar",message:"¿Está seguro de eliminar este registro?","text-cancel":"No","text-confirm":"Confirmar",loading:m.value,onOnConfirm:()=>v(s.id)},null,8,["loading","onOnConfirm"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"item.type":t(({item:s})=>[e(b,{color:s.type==="ASISTENCIAL"?"teal-darken-3":"blue-grey-darken-1","text-color":"white"},{default:t(()=>[u(O(s.type),1)]),_:2},1032,["color"])]),"item.status":t(({item:s})=>[e(f,{color:s.status?"blue":"error","text-color":"white",density:"compact",variant:"tonal"},{default:t(()=>[u(O(s.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["items-per-page","sort-by","page","headers","items","items-length","loading"])}}}),me=N({__name:"index",setup(_){const i=c(!1),d=c(!1),m=c([]),v=c(0),r=c({itemsPerPage:10,sortBy:[],page:1,search:"",filters:{}}),a=W(()=>{l()},400),l=async()=>{d.value=!0;const p=await X(r.value);m.value=p.data,v.value=p.total,d.value=!1},f=async()=>{i.value=!0,await l(),i.value=!1};return f(),(p,n)=>{const x=o("v-text-field"),b=o("v-col"),y=o("v-btn"),w=o("v-row"),s=o("v-card-item"),V=o("v-card"),S=F("tooltip");return U(),C(V,{title:"Categorías",subtitle:"Gestion de categorías",disabled:i.value},{default:t(()=>[e(s,{class:"border-t border-b"},{default:t(()=>[e(w,{class:"d-flex justify-space-between"},{default:t(()=>[e(b,{cols:"12",md:"4"},{default:t(()=>[e(x,{modelValue:r.value.search,"onUpdate:modelValue":n[0]||(n[0]=$=>r.value.search=$),label:"Buscar",clearable:"",onInput:T(a)},null,8,["modelValue","onInput"])]),_:1}),e(b,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:t(()=>[e(y,{class:"h-md-auto me-2",disabled:i.value},{default:t(()=>[n[1]||(n[1]=u(" nuevo ")),e(T(L),{onOnSuccess:l})]),_:1},8,["disabled"]),H(e(y,{class:"h-md-auto",density:"comfortable",icon:"mdi-reload",onClick:f,loading:d.value},null,8,["loading"]),[[S,"Recargar registros"]])]),_:1})]),_:1})]),_:1}),e(T(re),{options:r.value,loading:d.value,items:m.value,total:v.value,onOnUpdateTable:l},null,8,["options","loading","items","total"])]),_:1},8,["disabled"])}}});export{me as default};
